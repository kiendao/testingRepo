~~~~~ Code Sharing Area ~~~~~
 Use this box to share and edit code

<%-- initiate bv load --%>
<script type="text/javascript">
	var pagesize = "${pagesize}";
	var bvoffset = "0";
	var bvsort = "<wci:siteattribute attribute='pHT_ratingsAndReviewsIntegration' property='defaultsort' />";

	if(bvsort == "") {
		bvsort = "SubmissionTime:desc";
	}

	function callBazaarVoice(customPageSize, customOffset, customSort) {
		if(customPageSize != null) {
			pagesize = customPageSize;
		}

		if(customOffset != null) {
			bvoffset = customOffset;
		}

		if(customSort != null) {
			bvsort = customSort;
		}

		var bvProductID = "${fn:replace(bvoid, ':', '_')}";
		var head = document.getElementsByTagName('head')[0];
		var script= document.createElement('script');
		script.type= 'text/javascript';
		script.src= '<wci:siteattribute attribute="pHT_ratingsAndReviewsIntegration" property="wcireviewlink"/>&sort=' + bvsort + '&limit=' + pagesize + '&offset=' + bvoffset + '&Filter=ProductId:' + bvProductID + '&callback=renderReviewData';
		head.appendChild(script);

		$("#bvcontent").removeClass("bvready");
		$("#bvcontent").addClass("bvloader");
		$("#bvcontent").html("");
	}
	
	Handlebars.registerHelper('_ratingGraphic', function(){
		
		var DecimalSeparator = Number(this.Rating).toLocaleString().substr(1,1);
		
		var AmountWithCommas = Amount.toLocaleString();
		var arParts = String(AmountWithCommas).split(DecimalSeparator);
		var intPart = arParts[0];
		var decPart = (arParts.length > 1 ? arParts[1] : '');
		decPart = (decPart + '00').substr(0,2);
		
		return ('' + intPart + DecimalSeparator + decPart).replace(/[\.,]+/ig, '_');
	});
	
	Handlebars.registerHelper('categorydesc', function(oid) {
		// Do something here to get actual name
	    return 'ThinkPad W540';
	});
	
	Handlebars.registerHelper('times', function(n, block) {
	    var accum = '';
	    for(var i = 0; i < n; ++i)
	        accum += block.fn(i);
	    return accum;
	});
	
	function renderReviewData(bvjson){
		bvjson.heightclass = pagesize;
		var source   = $("#review-template").html();
		var template = Handlebars.compile(source);
		var html    = template(bvjson);
	}
		/*
	    $.each(bvjson.Results,function(i,item){
	    	//console.log(bvjson.Results[i].ReviewText);

	   $("#bvcontent").append($.parseHTML('<p>' + bvjson.Results[i].ReviewText + '</p>'));
	    }); }


		<%--var reviewData = "<ReviewData>" + json2xml.convert(bvjson, " ") + "</ReviewData>";
		//now that we have bv XML data load wci result template and form the UI
		$.post("${baseurl}/wci.workflow:load?page=/WW/site/templates/handlebars/cc_bv/cc_bv_result_template.html", { 'oid': '${oid}', 'bvdata' : reviewData, 'pagesize': pagesize }, function(htmldata) {
			$("#bvcontent").removeClass("bvloader");
			$("#bvcontent").addClass("bvready");
			$("#bvcontent").html(htmldata);
		})--%>
		*/

	callBazaarVoice();


</script>